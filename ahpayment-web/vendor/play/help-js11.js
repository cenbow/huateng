E.onDOMReady(function(){var cls="current",level=3,stepRoot=null,initTab=function(){var cTab=D.query(".c-tab"),catContainer=D.query(".showhow-menu")[0];shown=false;cTab.forEach(function(el){var _tabid=el.id;AP.widget.xTab.switchTab(_tabid,0,"click")});E.on(D.query(".thumb-detail"),"click",function(){var url=this.getAttribute("data-url");if(url)location.href=url});E.on(D.query(".thumb-detail"),"mouseover",function(){var cls=this.className.split(" ")[1];D.addClass(this,cls+"-hover")});E.on(D.query(".thumb-detail"),
"mouseout",function(){var cls=this.className.split(" ")[1];D.removeClass(this,cls+"-hover")});var trigger=D.query(".showhow-menu-fold")[0],iframe=D.getFirstChild(catContainer),keep=false;if(trigger){E.on([iframe,trigger],"mouseover",function(){keep=true;D.removeClass(catContainer,"fn-hide");if(!shown){shown=true;var iframe=D.getFirstChild(catContainer),win=iframe.contentWindow||iframe.contentDocument.parentWindow;iframe.style.height=win.getHeight()+"px";D.query(".w-950")[0].style["overflow"]="visible"}});
E.on(iframe,"mouseout",function(){keep=false;window.setTimeout(function(){keep||D.addClass(catContainer,"fn-hide")},300)});E.on(document.body,"click",function(){keep||D.addClass(catContainer,"fn-hide")})}},historyWatcher=function(){var timer,last;return{register:function(fn,thisObj){if(typeof fn!=="function")return;timer=window.setInterval(function(){if(location.hash!==last){last=location.hash;fn.call(thisObj||window,last)}},100)},stop:function(){timer&&window.clearInterval(timer)},set:function(newHash){last=
newHash;location.hash=newHash}}}(),getStepDesc=function(hash){var arr=hash.split("-"),path=[],link;while(arr.length){link=D.query('a[href="'+arr.join("-")+'"]',stepRoot);link.length&&path.unshift(link[0].innerHTML||"");arr.pop()}return path.join(" > ")},extractHash=function(link){var href=link.getAttribute("href");AP.env.browser.msie&&AP.env.browser.v===6&&alert(href+"\n"+location.pathname);if(!href||href.indexOf("#")===-1)return null;if(href[0]==="#")return href;var arr=href.split("#"),l=window.location;
return l.protocol+"//"+l.host+l.pathname==arr[0]?"#"+arr[1]:null},markStep=function(link,isFirst,isLast){var newClass=cls,parent=D.getAncestorByTagName(link,"ol");isFirst&&(newClass="first-current");isLast&&(newClass="last-current");D.removeClass(D.getFirstChild(parent),"first-current");isFirst?D.removeClass(D.getFirstChild(parent),"first"):D.addClass(D.getFirstChild(parent),"first");D.removeClass(D.getLastChild(parent),"last-current");isLast?D.removeClass(D.getLastChild(parent),"last"):D.addClass(D.getLastChild(parent),
"last");D.removeClass(D.getChildren(parent),cls);D.addClass(D.getAncestorBy(link),newClass)},enterStep=function(){var imgContainer=null,nodes0=null;markItem=function(nodes,hash){for(var i=0,len=nodes.length;i<len;i++)if(nodes[i].href.split("#").pop()===hash){markStep(nodes[i],i===0,i===len-1);return nodes[i]}throw"#"+hash+" not found.";};return function(hash){var step=["s1","1","1"];level==2&&step.pop();var mystep=(hash||location.hash).split("#").pop(),arr=mystep.split("-");for(var i=0,len=Math.min(step.length,
arr.length);i<len;i++)if(arr[i])step[i]=arr[i];nodes0=nodes0||[D.query("div.c-tab-ttl a"),D.query("div.c-tab-ctt")];markItem(nodes0[0],step[0]);var node0=D.get(step[0]);node0&&(D.hasClass(node0,cls)||D.removeClass(nodes0[1],cls)&&D.addClass(node0,cls));var nodes1=[D.query("ol.main-flow a",node0),D.query("ol.main-step",node0)],href=step[0]+"-"+step[1];var link=markItem(nodes1[0],href);var node1=D.get(href);imgContainer=imgContainer||D.getNextSibling(stepRoot);if(!D.isAncestor(imgContainer,node1)){D.removeClass(nodes1[1],
cls);D.addClass(node1,cls);link=markItem(D.query("a",node1),step.join("-"))}historyWatcher.set("#"+step.join("-"));showImage(imgContainer,link)}}(),showImage=function(container,link){var div=D.get(link.href.split("#").pop()),src=div.getAttribute("data-src"),me=arguments.callee;if(!src)throw'Customized attribute "data-src" not found';if(!me.image){me.loading=D.getFirstChild(container);var img=new Image;img.style.width=img.style.height="auto";img.onload=function(){D.addClass(me.loading,"fn-hide");D.removeClass(img,
"fn-hide")};D.insertAfter(img,me.loading);me.image=img;me.lastSrc=null}if(src===me.lastSrc)return;D.setStyle(D.query(".main-image > div"),"display","none");div.style.display="block";me.lastSrc=src;D.removeClass(me.loading,"fn-hide");D.addClass(me.image,"fn-hide");me.image.src=src;me.image.title=getStepDesc(location.hash);var map=D.getFirstChild(div);me.image.useMap=map?"#"+map.name:"";var next=D.getNextSibling(div);next&&((new Image).src=next.getAttribute("data-src"))},clickHandler=function(e){E.stopEvent(e);
this.href&&enterStep(this.href)},initStep=function(){level=D.query("div ol",stepRoot).length>1?3:2;D.addClass(stepRoot,"c-tab tab-flow");var hash=location.hash.split("#").pop().split("-"),nodes0=D.getChildren(stepRoot);var level0=nodes0.shift(),links=D.query("a",level0),div=document.createElement("div");if(links.length!==nodes0.length)throw"level0 is not matched.";div.className="c-tab-ttl";D.insertBefore(div,level0);div.appendChild(level0);links.forEach(function(link0,index){var id=link0.href.split("#").pop(),
level1=D.get(id);E.on(link0,"click",clickHandler);D.addClass(level1,"c-tab-ctt");var nodes1=D.getChildren(level1),container=[];container.push(nodes1.shift());if(container[0].nodeName!=="OL"){D.addClass(container[0],"fn-left");container.push(nodes1.shift())}var list=container[container.length-1],links=D.query("a",list);if(nodes1.length&&links.length!==nodes1.length)throw"level1 is not matched at "+level1.id;D.addClass(list,"main-flow");var div=document.createElement("div");div.className="main-flow-wrap";
D.insertBefore(div,container[0]);container.forEach(function(el){div.appendChild(el)});var nodes2=D.query("a",list);if(level===3){D.addClass(nodes1,"main-step");E.on(nodes2,"click",clickHandler);nodes2.forEach(function(link){var node=D.get(link.href.split("#").pop());E.on(D.query("a",node),"click",clickHandler)})}else E.on(nodes2,"click",clickHandler);D.query("area",D.getNextSibling(stepRoot)).forEach(function(area){var hash=extractHash(area);if(hash){area.title="\u8f6c\u5230 "+getStepDesc(hash);E.on(area,
"click",function(e){E.stopEvent(e);enterStep(this.href)})}})});if(AP.env.browser.misie6)enterStep();else historyWatcher.register(enterStep)};initTab();(stepRoot=D.get("J_step"))&&initStep()});function autoResize(Id){var frm=document.getElementById(Id);var subWeb=document.frames?document.frames[Id].document:frm.contentDocument;if(frm!=null&&subWeb!=null)frm.height=subWeb.body.scrollHeight+20+"px"}
window.onload=function(){if(top.window.location.href!=window.location.href)D.addClass(D.get("footer"),"fn-hide")};
AP.widget.slideshow=new AP.Class({setOptions:function(options){return AP.hashExtend({actionPanel:D.get("J_banner_action_panel"),showActionPanelIndex:false,viewpoint:D.get("J_banner_show"),bannerContainer:D.query(".banner-img")[0],banners:"img",fireMethod:"mouseover",hasDom:false,duartion:0.5,delay:5E3,activateTime:300,slideMethod:"horizontal",defaultCurBannerIndex:0,autoShow:true},options||{})},preloadImage:function(source){var img=new Image;img.src=source;this._options.bannerContainer.appendChild(img);
E.on(img,"load",function(){this.preloadImageDone(img)},{},this)},preloadImageDone:function(img){if(img.src==this._images[this._options.defaultCurBannerIndex].banner){if(this._options.slideMethod=="horizontal")this._options.bannerContainer.style.left=-this.bannerWidth*this._options.defaultCurBannerIndex+"px";else if(this._options.slideMethod=="vertical")this._options.bannerContainer.style.top=-this.bannerHeight*this._options.defaultCurBannerIndex+"px";else if(this._options.slideMethod=="opacity")D.setStyle(this.banners[this._options.defaultCurBannerIndex],
"zIndex","1");else;this.autoSlideShow()}},initialize:function(options,data){this._options=this.setOptions(options);this.autoShow=this._options.autoShow;this.bannerWidth=this._options.viewpoint.offsetWidth;this.bannerHeight=this._options.viewpoint.offsetHeight;this.curBannerIndex=this._options.defaultCurBannerIndex;var methods=["opacity","vertical","horizontal"];this.slideMethod=this._options.slideMethod=="random"?methods[Math.floor(Math.random()*methods.length)]:this._options.slideMethod;if(this._options.hasDom){this.banners=
D.query(this._options.banners,this._options.bannerContainer);this.autoSlideShow()}else{this._images=data;this._options.defaultCurBannerIndex=this._options.defaultCurBannerIndex>this._images.length-1?0:this._options.defaultCurBannerIndex;this.banners=D.query(this._options.banners,this._options.bannerContainer);this.initBannerContainer();this._images.forEach(function(el,n){this.preloadImage(el.banner,n)},this)}E.on(this._options.bannerContainer,"mouseover",function(){this.autoShow=false},{},this);E.on(this._options.bannerContainer,
"mouseout",function(){this.autoShow=this._options.autoShow;this.autoSlideShow()},{},this);E.on(this._options.actionPanel,"mouseover",this.mouseoverActionPanel,{},this);E.on(this._options.actionPanel,"mouseout",this.mouseoutActionPanel,{},this);this.createActionPanelLi()},initBannerContainer:function(){if(this.slideMethod=="horizontal"){this._options.bannerContainer.style.width=this.banners.length*this.bannerWidth+"px";this._options.bannerContainer.style.height=this.bannerHeight+"px"}else if(this.slideMethod==
"vertical"){this._options.bannerContainer.style.height=this.banners.length*this.bannerHeight+"px";this._options.bannerContainer.style.width=this.bannerWidth+"px"}else if(this.slideMethod=="opacity"){this.banners.forEach(function(el,n){D.setStyle(el,"position","absolute");D.setStyle(el,"zIndex","0")});this.zIndexNum=1}else;},createActionPanelLi:function(){var ul=document.createElement("ul");var nLen=this.banners.length;for(var i=0;i<nLen;i++){var li=document.createElement("li");if(this._images){li.title=
this._images[i].title;if(this._images[i].icon!=null)li.style.backgroundImage="url("+this._images[i].icon+")"}if(this._options.showActionPanelIndex)li.innerHTML=i+1;li.setAttribute("data-index",i);ul.appendChild(li);this.createActionPanelLiExtends(li,i)}this._options.actionPanel.appendChild(ul);this.changeActionPanelLiStyle(this._options.defaultCurBannerIndex)},createActionPanelLiExtends:function(li,i){E.on(li,this._options.fireMethod,function(ev){if(this.aniTimer)window.clearTimeout(this.aniTimer);
var n=parseInt(E.getTarget(ev).getAttribute("data-index"));var that=this;if(i!=this.curBannerIndex)this.aniTimer=window.setTimeout(function(){that.slideToBanner(i)},this._options.activateTime)},{},this);if(this._options.fireMethod=="mouseover"){E.on(li,"mouseover",function(ev){this.autoShow=false},{},this);E.on(li,"mouseout",function(){this.autoShow=this._options.autoShow;this.autoSlideShow()},{},this)}},changeActionPanelLiStyle:function(liIndex){D.query("li",this._options.actionPanel).forEach(function(el,
n){if(n==liIndex)D.addClass(el,"current");else D.removeClass(el,"current")},this)},autoSlideShow:function(){if(!this.autoShow)return false;if(this.aniTimer)window.clearTimeout(this.aniTimer);var that=this;this.aniTimer=window.setTimeout(function(){that.slideToBanner(that.curBannerIndex+1)},this._options.delay)},mouseoverActionPanel:function(){},mouseoutActionPanel:function(){},slideToBanner:function(nextBannerIndex){nextBannerIndex=nextBannerIndex>this.banners.length-1?0:nextBannerIndex;this.beforeAnimationEvent();
this.changeActionPanelLiStyle(nextBannerIndex);this.animation(this._options.bannerContainer,nextBannerIndex);this.curBannerIndex=nextBannerIndex},animation:function(obj,bannerIndex){if(this.slideMethod=="vertical")var anim=new YAHOO.util.Anim(obj,{top:{to:-bannerIndex*this.bannerHeight}},this._options.duartion,YAHOO.util.Easing.easeOut);else if(this.slideMethod=="horizontal"){if(this.curBannerIndex>bannerIndex)formX=-(bannerIndex+1)*this.bannerWidth;else formX=-(bannerIndex-1)*this.bannerWidth;var anim=
new YAHOO.util.Anim(obj,{left:{from:formX,to:-bannerIndex*this.bannerWidth}},this._options.duartion,YAHOO.util.Easing.easeOut)}else if(this.slideMethod=="opacity"){var banner=this.banners[bannerIndex];D.setStyle(banner,"opacity","0");D.setStyle(banner,"zIndex",++this.zIndexNum);var anim=new YAHOO.util.Anim(banner,{opacity:{to:1}},this._options.duartion,YAHOO.util.Easing.easeNone)}else;anim.animate();var that=this;anim.onComplete.subscribe(function(){that.afterAnimationEvent()},that)},beforeAnimationEvent:function(){},
afterAnimationEvent:function(){this.autoSlideShow();this.changeActionPanelLiStyle(this.curBannerIndex)}});